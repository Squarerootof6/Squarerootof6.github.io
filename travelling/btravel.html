<!DOCTYPE html>
<html>
    <head>
        <title>Genghao Liu's Homepage</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="../assets/css/main.css" />
        <link rel="stylesheet" href="./assets/css/main.css" />
        <noscript><link rel="stylesheet" href=".assets/css/noscript.css" /></noscript>
        <style>
          /* 初始状态下隐藏内容 */
          #hiddenContent {
              display: block;
          }
      </style>
    </head>

    <body class="is-preload">

      <div id="wrapper">
        <div id="main">
          <div class="inner">
          <!-- Header -->
          <header id="header">
              <a href="https://html5up.net/" class="logo" target="_blank"><strong>Editorial</strong> by HTML5 UP</a>
              <ul class="icons">
                  <li><a href="https://orcid.org/0009-0007-4049-127X" class="icon brands fa-orcid"><span class="label">ORCID</span></a></li>
                  <li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
                  <li><a href="https://www.facebook.com/profile.php?id=100009560453540" class="icon brands fa-facebook-f" target="_blank"><span class="label">Facebook</span></a></li>
                  <li><a href="https://github.com/Squarerootof6" class="icon brands fa-github"><span class="label">Github</span></a></li>
                  <li><a href="https://www.instagram.com/square_root_of_six/" class="icon brands fa-instagram" target="_blank"><span class="label">Instagram</span></a></li>
                  <li><a href="https://space.bilibili.com/34658125?spm_id_from=333.1007.0.0" class="icon brands fa-bilibili" target="_blank"><span class="label">BiliBili</span></a></li>
              </ul>
          </header>
          <section>
            <header class="major">
              <h2>Footprint Map</h2>
            </header>
            <div id="map" style="height: 60vh; width: 100%; margin: 0 auto"></div>
            <div id="hiddenContent" >
              <div class="poptrox-overlay" id="album" ></div>
            </div>
          </section>
          </div>
        
        </div>
          <!-- Sidebar -->
          <div id="sidebar">
              <div class="inner">

                  <!-- Search -->
                      <section id="search" class="alt">
                          <form method="post" action="#">
                              <input type="text" name="query" id="query" placeholder="Search" />
                          </form>
                      </section>

                  <!-- Menu -->
                      <nav id="menu">
                          <header class="major">
                              <h2>Menu</h2>
                          </header>
                          <ul>
                              <li><a href="../index.html">Homepage</a></li>
                              <li><a href="../generic.html">Generic</a></li>
                              <li><a href="../elements.html">Elements</a></li>
                              <li><a href="../Research.html">Research</a></li>
                              <li>
                                  <span class="opener">Hobbies</span>
                                  <ul>
                                      <li><a href="#">Volleyball</a></li>
                                      <li><a href="#">Guitar</a></li>
                                      <li><a href="#">Photography</a></li>
                                  </ul>
                              </li>
                              <li><a href="#">Publications</a></li>
                              <li><a href="#">Travelling</a></li>
                          </ul>
                      </nav>

                  
                  <!-- Section -->
                      <section>
                          <header class="major">
                              <h2>Get in touch</h2>
                          </header>
                          <p>If you are interested in any of my projects and would like to collaborate, do not hesitate to contact me!</p>
                          <ul class="contact">
                              <li class="icon brands fa-google"><a href="#">liugenghao0310@gmail.com</a></li>
                              <li class="icon solid fa-school"><a href="#">liugh33@mail2.sysu.edu.cn</a></li>
                              <li class="icon solid fa-envelope"><a href="#">squarerootof6@outlook.com</a></li>
                          </ul>
                      </section>
                  <!-- Footer -->
                      <footer id="footer">
                          <p class="copyright">&copy; Untitled. All rights reserved. Demo Images: <a href="https://unsplash.com">Unsplash</a>. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
                      </footer>

              </div>
          </div>
      </div>
      <script src="../assets/js/jquery.min.js"></script>
      <script src="../assets/js/browser.min.js"></script>
      <script src="../assets/js/breakpoints.min.js"></script>
      <script src="../assets/js/util.js"></script>
      <script src="../assets/js/main.js"></script>
                  
        <!-- 引入 ECharts -->
        <script src="echarts.min.js"></script>
        <!-- 引入百度地图扩展 -->
        <script src="https://api.map.baidu.com/api?v=3.0&ak=11KhO6AwgKNDOIiu4N6AEHozzcNOn4cq"></script>
        <script src="bmap.min.js"></script>
        <script type="text/javascript">
          var dom = document.getElementById('map');
          var myChart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
          });
          var app = {};
          
          var option;
          option = {
            title: {
              text: '刘耿昊的足迹',
              subtext: 'footprint of squareroot',
              left: 'center'
            },
            tooltip: {
              trigger: 'item'
            },
            bmap: {
              center: [104.114129, 37.550339],
              zoom: 5,
              roam: true,
              mapStyle: {
                styleJson: [
                  {
                    featureType: 'water',
                    elementType: 'all',
                    stylers: {
                      color: '#d1d1d1'
                    }
                  },
                  {
                    featureType: 'land',
                    elementType: 'all',
                    stylers: {
                      color: '#f3f3f3'
                    }
                  },
                  {
                    featureType: 'railway',
                    elementType: 'all',
                    stylers: {
                      visibility: 'off'
                    }
                  },
                  {
                    featureType: 'highway',
                    elementType: 'all',
                    stylers: {
                      color: '#fdfdfd'
                    }
                  },
                  {
                    featureType: 'highway',
                    elementType: 'labels',
                    stylers: {
                      visibility: 'off'
                    }
                  },
                  {
                    featureType: 'arterial',
                    elementType: 'geometry',
                    stylers: {
                      color: '#fefefe'
                    }
                  },
                  {
                    featureType: 'arterial',
                    elementType: 'geometry.fill',
                    stylers: {
                      color: '#fefefe'
                    }
                  },
                  {
                    featureType: 'green',
                    elementType: 'all',
                    stylers: {
                      visibility: 'off'
                    }
                  },
                  {
                    featureType: 'subway',
                    elementType: 'all',
                    stylers: {
                      visibility: 'off'
                    }
                  },
                  {
                    featureType: 'manmade',
                    elementType: 'all',
                    stylers: {
                      color: '#d1d1d1'
                    }
                  },
                  {
                    featureType: 'local',
                    elementType: 'all',
                    stylers: {
                      color: '#d1d1d1'
                    }
                  },
                  {
                    featureType: 'boundary',
                    elementType: 'all',
                    stylers: {
                      color: '#fefefe'
                    }
                  },
                  {
                    featureType: 'building',
                    elementType: 'all',
                    stylers: {
                      color: '#d1d1d1'
                    }
                  },
                ]
              }
            },
          };
          const data = [
          { name: '大理', value: 21,href:'../lens/index.html'},
          { name: '丽江', value: 34,href:'../lens/index.html'},
          ];
        var geoCoder = new BMap.Geocoder();
        const geoCoordMap = {};
        const promises = [];
        for (var i = 0; i < data.length; i++) {
            (function(index) {
                var city = data[index].name;
        
                var promise = new Promise(function(resolve, reject) {
                    geoCoder.getPoint(city, function(point) {
                        if (point) {
                            var lng = point.lng;
                            var lat = point.lat;
                            geoCoordMap[city] = [lng, lat];
                            resolve();
                        } else {
                            console.log('无法获取到经纬度');
                            reject();
                        }
                    });
                });
                promises.push(promise);
            })(i);
        }
        Promise.all(promises).then(function() {
            option['series'] = [
            {
              name: 'footprint',
              type: 'scatter',
              coordinateSystem: 'bmap',
              data: convertData(data),
              symbolSize: function (val) {
                return val[2] / 2;
              },
              encode: {
                value: 2
              },
              label: {
                formatter: '{b}',
                position: 'right',
                show: false
              },
              emphasis: {
                label: {
                  show: true
                }
              }
            },
            {
              name: 'Top 5',
              type: 'effectScatter',
              coordinateSystem: 'bmap',
              data: convertData(
                data
                  .sort(function (a, b) {
                    return b.value - a.value;
                  })
                  .slice(0, 6)
              ),
              symbolSize: function (val) {
                return val[2] / 2;
              },
              encode: {
                value: 2
              },
              showEffectOn: 'render',
              rippleEffect: {
                brushType: 'stroke'
              },
              label: {
                formatter: '{b}',
                position: 'right',
                show: true
              },
              itemStyle: {
                shadowBlur: 10,
                shadowColor: '#333'
              },
              emphasis: {
                scale: true
              },
              zlevel: 1
            }
          ]
            if (option && typeof option === 'object') {
              myChart.setOption(option);
            }
                window.addEventListener('resize', myChart.resize);
        }).catch(function() {
            console.log('处理地理编码操作时出错');
        });
        
      const convertData = function (data) {
        var res = [];
        for (var i = 0; i < data.length; i++) {
            var geoCoord = geoCoordMap[data[i].name];
            if (geoCoord) {
                res.push({
                    name: data[i].name,
                    value: geoCoord.concat(data[i].value),
                    href: data[i].href
                });
            }
        }
        return res;
    };
      myChart.on('click', function (params) {
        if (params.seriesType === 'scatter' || params.seriesType === 'effectScatter') {

            // 获取 <div class="poptrox-overlay" id="album"> 标签
            var album = document.getElementById('album');
            album.innerHTML = '';
            // 创建三个 <article class="thumb"> 标签，并添加到 <div class="poptrox-overlay" id="album"> 中
            var imgnum = parseInt(params.data.value[2]);
            for (var i = 1; i <= imgnum; i++) {
                var thumb = document.createElement('article');
                var h2 = document.createElement('h2');
                var link = document.createElement('a');
                var p = document.createElement('p');
                var img = document.createElement('img');
                img.src =   "./images/"+params.data.name+"/thumbs/"+i.toString().padStart(2, '0')+".jpg";
                link.href = "./images/"+params.data.name+"/fulls/"+i.toString().padStart(2, '0')+".jpg";
                link.className = 'image';
                link.appendChild(img);
                h2.textContent = i;
                p.textContent = 'Nunc blandit nisi ligula magna sodales lectus elementum non. Integer id venenatis velit.';
                thumb.className = 'thumb';
                thumb.appendChild(link);
                thumb.appendChild(h2);
                thumb.appendChild(p);
                album.appendChild(thumb);
            }
          
          var hiddenContent = document.getElementById('hiddenContent');
            var js = document.createElement('script');
            js.src = "./assets/js/jquery.min.js"
            album.appendChild(js)
            var js = document.createElement('script');
            js.src = "./assets/js/jquery.poptrox.min.js"
            album.appendChild(js)
            var js = document.createElement('script');
            js.src = "./assets/js/browser.min.js"
            album.appendChild(js)
            var js = document.createElement('script');
            js.src = "./assets/js/breakpoints.min.js"
            album.appendChild(js)
            var js = document.createElement('script');
            js.src = "./assets/js/util.js"
            album.appendChild(js)
            var js = document.createElement('script');
            js.src = "./assets/js/main.js"
            hiddenContent.appendChild(js)
              // 如果内容是隐藏的，则显示它；如果已经显示，则隐藏它
              //if (hiddenContent.style.display === 'none') {
              //    hiddenContent.style.display = 'block';
              //} else {
              //    hiddenContent.style.display = 'none';
              //}
        }
    });
        </script>
      
    </body>
</html>